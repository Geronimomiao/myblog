---
title: 网络一些问题
time:  2019-9-30
author: wsm
mail: 1030057982@qq.com
---

#### TCP
**为什么要有TIME_WAIT状态？**
* 确保有足够的时间让server接收ACK包
	*  可靠终止TCP连接。如果最后一个ACK报文因为网络原因被丢弃，此时server因为没有收到ACK而超时重传FIN报文，处于TIME_WAIT状态的client可以继续对FIN报文做回复，向server发送ACK报文
* 避免新旧链接混淆
	* 保证让迟来的TCP报文段有足够的时间被识别和丢弃。连接结束了，网络中的延迟报文也应该被丢弃掉，以免影响立刻建立的新连接

**为什么建立连接是三次握手，关闭连接却是四次挥手呢？**
* 全双工模式
	* 建立连接的时候， 服务器在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端
	* 而关闭连接时，服务器收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，而自己也未必把全部数据都发送给了对方，所以己方可以立即关闭，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送，从而导致多了一次

**服务器出现大量CLOSE_WAIT状态的原因？**
* 客户端关闭scoket链接后，服务器端忙于读或者写，未能及时关闭连接。
	* 解决方法是：
		* 检查代码，特别是释放资源相关的代码
		* 检查配置：特别是处理请求的线程配置

####  关于MAC地址和IP地址在传输过程中变与不变的问题
* mac地址在同一个广播域传输过程中是不变的，在跨越广播域的时候会发生改变的
* IP地址在传输过程中是不会改变的（除NAT的时候）

