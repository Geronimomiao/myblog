---
title: 内存分配
---

## 内存

#### 硬件角度

内存是计算机必不可少的一个组成部分，是于CPU沟通的桥梁，计算机中所有的程序都是运行在内存中的

#### 逻辑角度

内存是一块具备随机访问能力，支持读、写操作，用来存放程序及程序运行中产生的数据的区域


![C语言内存组成](https://upload-images.jianshu.io/upload_images/2474121-e6e531010176eb33.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

> 代码段、数据段、BSS段在程序编译期间由编译器分配空间，在程序启动时加载，由于未初始化的全局变量存放在BSS段，已初始化的全局变量存放在数据段，所以程序中应该尽量少的使用全局变量以节省程序编译和启动时间；栈和堆在程序运行中由系统分配空间


## BSS段

Block Started by Symbol的简称，通常是指用来存放程序中未初始化的全局变量和静态变量。

## 数据段

通常是指用来存放程序中已初始化的全局变量和静态变量以及字符串常量

## 代码段

通常是指用来存放程序执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定。

## 栈内存

**用栈作为内存中存储结构**，通常存放程序临时创建的局部变量，即函数括大括号 “{ }” 中定义的变量，其中还包括函数调用时其形参，调用后的返回值等。 栈是由到高地址向低地址扩展的数据结构。即依次定义两个局部变量，首先定义的变量的地址是高地址，其次变量的地址是低地址

小内存、自动化、可能会溢出

## 堆内存

通常存放程序运行中动态分配的存储空间。堆是低地址向高地址扩展的数据结构，是一块不连续的内存区域

大内存、手工分配管理、申请大小随意、可能会泄露

堆内存是操作系统划分给堆管理器来管理的，管理器向使用者（用户进程）提供API（malloc和free等）来使用堆内存。需要程序员手动分配释放，如果程序员在使用完申请后的堆内存却没有及时把它释放掉，那么这块内存就丢失了

## 函数调用与内存分配

**函数运行期间调用另外一个函数，在运行被调用函数之前，系统需要先完成3件事情**
将所有的实参、返回地址等信息传递给被调用函数保存
为被调用函数局部变量在栈上分配内存
将控制转移到被调用函数入口

**被调用函数返回调用函数之前，系统也需要相应的完成3件事情**
在栈中保存被调用函数的计算结果（返回值）
释放在栈中为被调用函数分配的数据区
依照被调用函数保存的返回地址将控制转移到调用函数

> 函数之间信息传递和控制转移必须通过“栈”来实现，即系统将整个程序运行所需的数据空间安排在一个栈中，每当调用一个函数就为它在栈顶分配一个存储区，每当从一个函数退出时，就释放它的存储区，当前正在运行的函数存储区必在栈顶。

#### 帧栈

帧栈也叫过程活动记录，是编译器用来实现过程/函数调用的一种数据结构。每个栈帧对应着一个未运行完的函数。栈帧中保存了该函数形参、返回地址、局部变量等信息。简而言之栈帧就是一个函数执行的环境。有时候函数嵌套调用，栈中会有多个函数的信息，每个函数占用一个连续的区域。引文中提到的“存储区”就是指一个函数对应的分配空间也就是一个函数帧

#### 参数的传递和内存分配

被调用函数的形参，在未出现函数调用时不占用内存空间，发生函数调用时，形参按照确定的类型在该函数帧中被分配指定大小的空间。并且由调用函数的实参传递给被调用函数的形参保存。

#### 函数具体调用过程

1. 为被调用函数在栈顶分配空间，为被调用函数的形参分配空间
2. 将实参的值传递给形参
3. 被调用函数利用形参（如果存在）进行运算
4. 通过return语句将返回值带回调用函数
5. 调用结束，释放被调用函数空间，释放其形参分配空间



[传送门1](https://www.jianshu.com/p/b2380e47d005)

[传送门2](https://www.jianshu.com/p/ccb337572498)


## 补充 js delete null

delete 操作符是删除属性的唯一方法。把属性设置为undefined或者null不能真正的删除属性，它只是移除了属性和值的关联。

语法：delete 对象名.属性名

